generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Role {
  id        Int          @id @default(autoincrement())
  name      String       @unique
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
  modules   RoleModule[]
  users     User[]
}

model Module {
  id          Int          @id @default(autoincrement())
  name        String       @unique
  description String?
  roles       RoleModule[]
}

model RoleModule {
  id        Int     @id @default(autoincrement())
  roleId    Int
  moduleId  Int
  canCreate Boolean @default(false)
  canDelete Boolean @default(false)
  canRead   Boolean @default(false)
  canUpdate Boolean @default(false)
  status    Boolean @default(false)
  module    Module  @relation(fields: [moduleId], references: [id], onDelete: Cascade)
  role      Role    @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@unique([roleId, moduleId])
}

model User {
  id           Int           @id @default(autoincrement())
  email        String        @unique
  password     String
  roleId       Int
  Bio          String?
  firstname    String?
  lastname     String?
  address      String?
  country      String?
  phone        String?
  postalcode   String?
  state        String?
  activityLogs ActivityLog[]
  role         Role          @relation(fields: [roleId], references: [id], onDelete: Cascade)
}

model ActivityLog {
  id          Int      @id @default(autoincrement())
  userId      Int?
  action      String
  description String?
  entityType  String?
  entityId    Int?
  ipAddress   String?
  userAgent   String?
  createdAt   DateTime @default(now())
  user        User?    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model EmailTemplate {
  id        Int      @id @default(autoincrement())
  name      String   @unique
  subject   String
  body      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Blog {
  id         Int      @id @default(autoincrement())
  title      String
  content    String
  image_url  String?
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
  tagId      String?
  tagurl     String?
  titleurl   String?
}

model Tag {
  id   Int    @id @default(autoincrement())
  name String @unique
}

model SeoPages {
  id            Int      @id @default(autoincrement())
  title         String
  slug          String   @unique
  content       String
  meta_title    String?
  meta_desc     String?
  meta_keywords String?
  created_at    DateTime @default(now())
  updated_at    DateTime @updatedAt
  seopage       String?
}

model Notification {
  id           Int      @id @default(autoincrement())
  userId       Int?
  message      String   @db.VarChar(500)
  isRead       Boolean  @default(false)
  type         String?  @db.VarChar(50)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  uuid         String   @unique @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  globaluserid String?

  @@index([userId])
}

model Subscription {
  id                   Int       @id @default(autoincrement())
  userId               Int?
  stripeCustomerId     String
  stripeSubscriptionId String
  status               String
  currentPeriodEnd     DateTime?
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @default(now()) @updatedAt
}


model Category {
  id                 Int        @id @default(autoincrement())
  name               String     @db.VarChar(150)
  slug               String     @unique @db.VarChar(150)
  parent_category_id Int?
  level              Int        @default(1)
  description        String?
  icon               String?    @db.VarChar(100)
  sort_order         Int        @default(0)
  status             String     @default("active") @db.VarChar(20)
  is_featured        Boolean    @default(false)
  full_path          String?    @db.VarChar(500)
  path_ids           String?    @db.VarChar(255)
  created_by         Int?
  updated_by         Int?
  created_at         DateTime   @default(now())
  updated_at         DateTime?
  parent             Category?  @relation("CategoryHierarchy", fields: [parent_category_id], references: [id], onDelete: Cascade)
  children           Category[] @relation("CategoryHierarchy")

  @@index([slug])
  @@index([parent_category_id])
}

model Patients {
  id              Int       @id @default(autoincrement())
  patient_code    String    @unique
  first_name      String?
  last_name       String?
  gender          String?
  dob             DateTime?
  phone           String?
  email           String?   @unique
  password        String?
  reset_token     String?
  reset_token_exp DateTime?
  address         String?
  city            String?
  state           String?
  pincode         String?
  notes           String?
  status          Int       @default(0)
  created_at      DateTime  @default(now())
  updated_at      DateTime  @updatedAt
  uuid            String    @unique @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  blockreason     String?
}

model ClinicUser {
  id               Int       @id @default(autoincrement())
  uuid             String    @unique @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email            String    @unique
  phone            String?
  passwordHash     String
  resetToken       String?   @unique
  resetTokenExpiry DateTime?
  isVerified       Boolean   @default(false)
  isActive         Boolean   @default(true)
  lastLogin        DateTime?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  refreshToken     String?
  firstname        String?
  lastname         String?
  isOtpVerify      Boolean   @default(false)
  status           Int @default(0)
  clinics          Clinic[]
  
}



model Clinic {
  id             Int                  @id @default(autoincrement())
  userId         Int
  name           String
  description    String?
  address        String?
  city           String?
  state          String?
  country        String?
  phone          String?
  email          String?
  imageUrl       String?
  priorityLevel  Int                  @default(0)
  promotionEnd   DateTime?
  isActive       Boolean              @default(true)
  createdAt      DateTime             @default(now())
  updatedAt      DateTime             @updatedAt
  clinic_code    String?              @unique
  uuid           String               @unique @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clinicUserId   Int?
  clinicUserUuid String?
  clinicUser     ClinicUser?          @relation(fields: [clinicUserId], references: [id])
  orders         ClinicListingOrder[]
  clinicDoctors ClinicDoctor[]
  clinicDoctorAddress ClinicDoctorAddress[]
  clinics     ClinicSpecialization[]
  clinicsSpecialty     ClinicSpecialty[]
  clinicTreatments ClinicTreatment[]

}



model ClinicImages {
  id         Int      @id @default(autoincrement())
  uuid       String   @unique @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clinicuuid String?
  type       String?
  Images     String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  sort       String?
}

model ClinicSurgeryImage {
  id         String   @id @default(uuid()) @db.Uuid
  uuid       String   @unique @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clinicUuid String?
  doctorUuid String?
  treatmentid String?
  imageType  String?
  imageUrl   String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  type       String?
  surgeryId  String?
}

model ListingPackage {
  id                  Int                  @id @default(autoincrement())
  name                String
  description         String?
  price               Decimal              @db.Decimal(10, 2)
  durationDays        Int
  priorityLevel       Int                  @default(1)
  isActive            Boolean              @default(true)
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  listinfpackage_code String?              @unique
  uuid                String               @unique @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  orders              ClinicListingOrder[]
}

model ClinicListingOrder {
  id                 Int            @id @default(autoincrement())
  clinicId           Int
  packageId          Int
  userId             Int
  stripePaymentId    String?        @unique
  amount             Decimal        @db.Decimal(10, 2)
  startDate          DateTime
  endDate            DateTime
  status             String         @default("ACTIVE")
  createdAt          DateTime       @default(now())
  updatedAt          DateTime       @updatedAt
  cliniclistingorder String?        @unique
  uuid               String         @unique @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clinic             Clinic         @relation(fields: [clinicId], references: [id])
  package            ListingPackage @relation(fields: [packageId], references: [id])
}

model Accreditation {
  id          Int                   @id @default(autoincrement())
  uuid        String                @unique @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  image       String?
  name        String?
  description String?
  createdAt   DateTime              @default(now())
  updatedAt   DateTime              @updatedAt
  selectedBy  ClinicAccreditation[]
}

model ClinicAccreditation {
  id              Int           @id @default(autoincrement())
  uuid            String        @unique @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  accreditationId Int
  clinicuuid      String?
  accreditation   Accreditation @relation(fields: [accreditationId], references: [id])

  @@unique([clinicuuid, accreditationId])
}

model ClinicDescription {
  id               Int      @id @default(autoincrement())
  uuid             String   @unique @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  briefDescription String?
  fullDescription  String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  clinicuuid       String?
}



model Doctor {
  id         Int      @id @default(autoincrement())
  uuid       String   @unique @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clinicuuid String?
  firstname  String?
  lastname   String?
  email      String?
  dob        String?
  crm        String?
  languages  Json?
  videurl    String?
  image      String?
  cpf        String?
  degree     String?


  briefDescription String?
  fullDescription  String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt



  specializations DoctorSpecialization[]
  specialtys      DoctorSpecialty[]
  doctorTreatments DoctorTreatment[]
  clinicDoctors ClinicDoctor[]
  clinicDoctorAddress ClinicDoctorAddress[]
  packagesDoctor   PackageDoctor[] @relation("DoctorsuuidFk")
  



}

model ClinicDoctor {
  id          String   @id @default(uuid()) @db.Uuid
  clinicUuid  String   @db.Uuid
  doctorUuid  String   @db.Uuid
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  clinic      Clinic   @relation(fields: [clinicUuid], references: [uuid])
  doctor      Doctor   @relation(fields: [doctorUuid], references: [uuid])

  @@unique([clinicUuid, doctorUuid])
}



model ClinicDoctorAddress {
  
  id          String   @id @default(uuid()) @db.Uuid
  clinicUuid  String   @db.Uuid
  doctorUuid  String   @db.Uuid

  zipcode       String?
  street        String?
  complement    String?
  postalUnit    String?
  neighborhood  String?
  city          String?
  stateCode     String?
  stateName     String?
  region        String?
  ibgeCode      String?
  giaCode       String?
  areaCode      String?
  siafiCode     String?


  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  clinic      Clinic   @relation(fields: [clinicUuid], references: [uuid])
  doctor      Doctor   @relation(fields: [doctorUuid], references: [uuid])

}






model Specialization {
  id          String   @id @default(uuid()) @db.Uuid
  name        String   @unique
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  doctors                   DoctorSpecialization[]
  clinics                   ClinicSpecialization[]
  packagesSpecialization    PackageSpecialization[]
  

}

model ClinicSpecialization{
  id                     String         @id @default(uuid()) @db.Uuid
  clinicUuid             String         @db.Uuid
  specializationId       String?         @db.Uuid
  suggestedCategoryId    String?               @db.Uuid

  createdAt              DateTime       @default(now())
  suggestedCategory      SpecializationRequest? @relation(fields: [suggestedCategoryId], references: [id])
  clinic           Clinic         @relation(fields: [clinicUuid], references: [uuid])
  specialization   Specialization? @relation(fields: [specializationId], references: [id])
  @@unique([clinicUuid, specializationId])
}






model DoctorSpecialization {
  id                     String         @id @default(uuid()) @db.Uuid
  doctorUuid             String         @db.Uuid
  specializationId       String?         @db.Uuid
  suggestedCategoryId    String?               @db.Uuid

  createdAt              DateTime       @default(now())
  suggestedCategory      SpecializationRequest? @relation(fields: [suggestedCategoryId], references: [id])
  doctor           Doctor         @relation(fields: [doctorUuid], references: [uuid])
  specialization   Specialization? @relation(fields: [specializationId], references: [id])
  @@unique([doctorUuid, specializationId])
}


model SpecializationRequest {
  id           String   @id @default(uuid()) @db.Uuid
  type         String?   
  name         String
  description  String?
  status       String   @default("pending")
  adminNote    String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  doctorSpecializations DoctorSpecialization[]
  doctorspecialty       DoctorSpecialty[]
  doctorTreatments      DoctorTreatment[]
  clinicSpecialization  ClinicSpecialization[]
  clinicsSpecialty      ClinicSpecialty[]
  clinicTreatment       ClinicTreatment[]
  packageSpecialization PackageSpecialization[]
  packageSpecialty      PackageSpecialty[]
  packageTreatment      PackageTreatment[]
  packageProcedure      PackageProcedure[]
  

}



model Specialty {
  id          String   @id @default(uuid()) @db.Uuid
  name        String   @unique
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  doctors     DoctorSpecialty[]
  clinicsSpecialty     ClinicSpecialty[]
  packageSpecialty      PackageSpecialty[]
}




model ClinicSpecialty{
  id                  String        @id @default(uuid()) @db.Uuid
  clinicUuid          String        @db.Uuid
  specialtyId         String?       @db.Uuid
  suggestedCategoryId String?       @db.Uuid
  createdAt           DateTime      @default(now())

  clinic           Clinic                  @relation(fields: [clinicUuid], references: [uuid])
  specialty        Specialty?              @relation(fields: [specialtyId], references: [id])
  suggestedCategory SpecializationRequest? @relation(fields: [suggestedCategoryId], references: [id])

  @@unique([clinicUuid, specialtyId])
}



model DoctorSpecialty {
  id                  String        @id @default(uuid()) @db.Uuid
  doctorUuid          String        @db.Uuid
  specialtyId         String?       @db.Uuid
  suggestedCategoryId String?       @db.Uuid
  createdAt           DateTime      @default(now())

  doctor           Doctor                  @relation(fields: [doctorUuid], references: [uuid])
  specialty        Specialty?              @relation(fields: [specialtyId], references: [id])
  suggestedCategory SpecializationRequest? @relation(fields: [suggestedCategoryId], references: [id])

  @@unique([doctorUuid, specialtyId])
}

model Treatment{
  id          String   @id @default(uuid()) @db.Uuid
  name        String   @unique
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt


  doctorTreatments DoctorTreatment[]
  clinicTreatments ClinicTreatment[]
  packageTreatments PackageTreatment[]
}


model ClinicTreatment{

  id                  String        @id @default(uuid()) @db.Uuid
  clinicUuid          String        @db.Uuid
  treatmentid         String?       @db.Uuid
  suggestedCategoryId String?       @db.Uuid
  createdAt           DateTime      @default(now())

  clinic           Clinic           @relation(fields: [clinicUuid], references: [uuid])
  treatment        Treatment?       @relation(fields: [treatmentid], references: [id])
  suggestedCategory SpecializationRequest? @relation(fields: [suggestedCategoryId], references: [id])

  @@unique([clinicUuid, treatmentid])
}




model DoctorTreatment{
  id                  String        @id @default(uuid()) @db.Uuid
  doctorUuid          String        @db.Uuid
  treatmentid         String?       @db.Uuid
  suggestedCategoryId String?       @db.Uuid
  createdAt           DateTime      @default(now())

  doctor           Doctor           @relation(fields: [doctorUuid], references: [uuid])
  treatment        Treatment?       @relation(fields: [treatmentid], references: [id])
  suggestedCategory SpecializationRequest? @relation(fields: [suggestedCategoryId], references: [id])

  @@unique([doctorUuid, treatmentid])
}


model ClinicPackage {
  id          String        @id @default(uuid()) @db.Uuid
  clinicId    String        @db.Uuid
  title       String
  briefdescription String?
  fulldescription  String?
  actualprice      String?
  discountedprice  String?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  packages    PackageSpecialization[]
  package     PackageSpecialty[]
  boosts      ClinicBoost[]
  packagestreatment   PackageTreatment[]
  packagespackages    PackageProcedure[]
  fieldValues PackageFieldValue[]
  packagesDoctor   PackageDoctor[] @relation("PackageDoctors")
  



}

model BoostPackage {
  id           String        @id @default(uuid()) @db.Uuid
  name         String
  durationDays Int
  price        Decimal       @db.Decimal(10, 2)  // Correct type
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt

  clinics      ClinicBoost[]

}

model ClinicBoost {
  id               String        @id @default(uuid()) @db.Uuid
  clinicPackageId  String        @db.Uuid
  boostPackageId   String        @db.Uuid
  startAt          DateTime      @default(now())
  endAt            DateTime
  isActive         Boolean       @default(true)
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
  clinicuserid     String?

  clinicPackage    ClinicPackage @relation(fields: [clinicPackageId], references: [id])
  boostPackage     BoostPackage  @relation(fields: [boostPackageId], references: [id])

}




model PackageSpecialization{
  id                     String         @id @default(uuid()) @db.Uuid
  packageId             String         @db.Uuid
  specializationId       String?        @db.Uuid
  suggestedCategoryId    String?        @db.Uuid

  createdAt              DateTime       @default(now())

  
  suggestedCategory      SpecializationRequest? @relation(fields: [suggestedCategoryId], references: [id])
  packages               ClinicPackage         @relation(fields: [packageId], references: [id])
  specialization         Specialization? @relation(fields: [specializationId], references: [id])
}



model PackageSpecialty {
  id                  String        @id @default(uuid()) @db.Uuid
  packageid           String         @db.Uuid
  specialtyId         String?       @db.Uuid
  suggestedCategoryId String?       @db.Uuid
  createdAt           DateTime      @default(now())

  package           ClinicPackage?          @relation(fields: [packageid], references: [id])
  specialty         Specialty?              @relation(fields: [specialtyId], references: [id])
  suggestedCategory SpecializationRequest? @relation(fields: [suggestedCategoryId], references: [id])
}


model PackageTreatment{

  id                         String        @id @default(uuid()) @db.Uuid
  packageId                  String        @db.Uuid
  treatmentid                String?       @db.Uuid
  suggestedCategoryId        String?       @db.Uuid
  createdAt                  DateTime      @default(now())

  packagestreatment           ClinicPackage           @relation(fields: [packageId], references: [id])
  treatment                   Treatment?       @relation(fields: [treatmentid], references: [id])
  suggestedCategory           SpecializationRequest? @relation(fields: [suggestedCategoryId], references: [id])
}


model Procedure {
  id          String    @id @default(uuid())
  name        String
  description String?
  isActive    Boolean @default(false)

  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  procedure PackageProcedure[]
}




model PackageProcedure {
  id            String   @id @default(uuid()) 
  packageId                  String        @db.Uuid
  procedureid   String?
  suggestedCategoryId        String?       @db.Uuid
  
  createdAt                  DateTime      @default(now())
  packagespackages           ClinicPackage           @relation(fields: [packageId], references: [id])
  procedure     Procedure? @relation(fields: [procedureid], references: [id])
  suggestedCategory           SpecializationRequest? @relation(fields: [suggestedCategoryId], references: [id])
}




model PackageFieldDefinition {
  id        String   @id @default(uuid()) @db.Uuid

  fieldKey   String   @unique   
  label      String             
  fieldType  String            
  required   Boolean  @default(false)

  createdAt DateTime @default(now())
  fieldValues PackageFieldValue[]
}




model PackageFieldValue {
  id          String   @id @default(uuid()) @db.Uuid
  packageId   String   @db.Uuid
  fieldId     String   @db.Uuid

  valueText    String?
  valueNumber  Int?
  valueBoolean Boolean?
  valueDate    DateTime?

  createdAt DateTime @default(now())

  package ClinicPackage @relation(fields: [packageId], references: [id])
  field   PackageFieldDefinition @relation(fields: [fieldId], references: [id])

  @@unique([packageId, fieldId])
}




model PackageDoctor {
  id        String   @id @default(uuid()) @db.Uuid
  packageId String   @db.Uuid
  doctorId  String   @db.Uuid

  packages  ClinicPackage @relation("PackageDoctors", fields: [packageId], references: [id])
  doctors   Doctor  @relation("DoctorsuuidFk", fields: [doctorId], references: [uuid])
  
  createdAt DateTime @default(now())
}
